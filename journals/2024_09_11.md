# DOING [[Python]] asyncio 的基本使用
:LOGBOOK:
CLOCK: [2024-09-11 Wed 16:31:41]
CLOCK: [2024-09-11 Wed 16:31:45]
:END:
	- 问题：
		- 事件循环是什么，怎么用
		  logseq.order-list-type:: number
		- 理解Future，Coroutine，Task（和js对比）
		  logseq.order-list-type:: number
		- 创建和当前协程无关的异步任务，以及挪到其他线程/线程池去执行的任务
		  logseq.order-list-type:: number
		- 在同步代码中调用异步任务
		  logseq.order-list-type:: number
		- 协程间同步操作（锁，信号量，any，all）
		  logseq.order-list-type:: number
	- Python的事件循环和js的类似——事件，定时器，事件队列，回调……区别在于，js的事件循环更多是以回调函数为机制，而Python的事件循环则是基于协程，而且允许多线程，允许同时存在多个事件循环，但每个线程只能存在一个事件循环，代码逻辑均在该线程上执行，除了使用run_in_executor创建的任务，它们会在线程池或进程池上执行。
	- 启动事件循环的最简单的方法是`async.run`，它只能在主线程上执行，通过一个协程（async函数返回的就是协程Coroutine，行为类似生成器）启动，创建一个事件循环并阻塞直到所有协程执行完毕：
		- ```python
		  import asyncio
		  lock = asyncio.Lock()
		  async def go():
		      async with lock:
		          await asyncio.sleep(1)
		          print('Hello!') 
		      
		  async def main():
		      await asyncio.gather(go(), go(), go())
		  
		  print('before')
		  asyncio.run(main())
		  print('after')
		  ```
	- `async.run`显然只是一个方便